<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div>
        <div>
            <label for="memAccount">帳號: </label>
            <input type="text" name="memAccount" id="memAccount">
            <label id="l1"></label>
        </div>
        <div>
            <label for="memPassword">密碼: </label>
            <input type="password" name="memPassword" id="memPassword">
            <label id="l2"></label>
        </div>
        <div>
            <label for="confirmPassword">確認密碼: </label>
            <input type="password" name="confirmPassword" id="confirmPassword">
            <label id="l3"></label>
        </div>
        <div>
            <label for="memName">帳戶名稱: </label>
            <input type="text" name="memName" id="memName">
            <label id="l4"></label>
        </div>
        <div>
            <label for="memMobile">行動電話: </label>
            <input type="text" name="memMobile" id="memMobile">
            <label id="l5"></label>
        </div>

        <div class="city-selector-set">
            <div>
                <label for="memCity">居住縣市: </label>
                <select class="county" id="memCity"></select>
                <label id="s1"></label>
            </div>
            <div>
                <label for="memDist">鄉/鎮/市/區: </label>
                <select class="district" id="memDist"></select>
                <label id="s2"></label>
            </div>
        </div>

        <div>
            <label for="memAdd">地址: </label>
            <input type="text" name="memAdd" id="memAdd">
            <label id="l6"></label>
        </div>
        <div>
            <label for="memEmail">E-mail: </label>
            <input type="text" name="memEmail" id="memEmail">
            <label id="l7"></label>
        </div>
        <div>
            <label for="memBirth">出生年月日: </label>
            <input type="text" name="memBirth" id="memBirth">
            <label id="d1"></label>
        </div>
        <div>
            <button id="btn1" type="button" class="btn btn-primary">註冊</button>
            <label id="l8"></label>
        </div>

    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tw-city-selector@2.1.1/dist/tw-city-selector.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/CGA101G1/datetimepicker/jquery.datetimepicker.css" />
    <script src="/CGA101G1/datetimepicker/jquery.js"></script>
    <script src="/CGA101G1/datetimepicker/jquery.datetimepicker.full.js"></script>
    <script>
        //日期
        $.datetimepicker.setLocale('zh'); // kr ko ja en
        $('#memBirth').datetimepicker({
            theme: '',          //theme: 'dark',
            timepicker: false,   //timepicker: false,
            step: 1,            //step: 60 (這是timepicker的預設間隔60分鐘)
            format: 'Y-m-d ',
            value: new Date(),
            //disabledDates:    ['2022/06/08','2022/06/09','2022/06/10'], // 去除特定不含
            //startDate:	        '2022/07/10',  // 起始日
            //minDate:           '-1970-01-01', // 去除今日(不含)之前
            //maxDate:           '+1970-01-01'  // 去除今日(不含)之後
        });
        var somedate2 = new Date();
        $('#memBirth').datetimepicker({
            beforeShowDay: function (date) {
                if (date.getYear() > somedate2.getYear() ||
                    (date.getYear() == somedate2.getYear() && date.getMonth() > somedate2.getMonth()) ||
                    (date.getYear() == somedate2.getYear() && date.getMonth() == somedate2.getMonth() && date.getDate() > somedate2.getDate())
                ) {
                    return [false, ""]
                }
                return [true, ""];
            }
        });
        //居住地
        new TwCitySelector({
            el: '.city-selector-set',
            elCounty: '.county',
            elDistrict: '.district'
        });

        $('#memAccount').blur(
            () => {

                $.ajax({
                    type: 'POST',
                    url: '/CGA101G1/mem/MemAccountAuthServlet',
                    data: JSON.stringify({
                        memAccount: memAccount.value
                    }),
                    success: data => {
                        let { successful, message } = data;
                        const r1 = /^[A-Za-z\d]{6,12}$/;
                        if (r1.test($('#memAccount').val()) && successful) {
                            $('#l1').text(`格式正確`)
                        } else if ($('#memAccount').val().length === 0) {
                            $('#l1').text(`尚未輸入`);
                        } else if (!successful) {
                            $('#l1').text(message);
                        } else
                            $('#l1').text(`請輸入英文及數字，且帳號長度需大於5小於13字數`);


                    }
                })
            })
        $('#memPassword').blur(
            () => {
                const r1 = /^[A-Za-z\d]{6,12}$/;
                if (r1.test($('#memPassword').val())) {
                    $('#l2').text(`格式正確`)
                } else if ($('#memPassword').val().length === 0) {
                    $('#l2').text(`尚未輸入`);
                } else
                    $('#l2').text(`請輸入英文及數字，且密碼長度需大於5小於13字數`);
            })
        $('#confirmPassword').blur(
            () => {
                if ($('#memPassword').val() === $('#confirmPassword').val() && $('#confirmPassword').val().length !== 0 && $('#confirmPassword').val() !== "") {
                    $('#l3').text(`密碼一致`)
                } else if ($('#confirmPassword').val().length === 0) {
                    $('#l3').text(`尚未輸入`);
                } else
                    $('#l3').text(`密碼不一致`);
            })
        $('#memName').blur(
            () => {
                if ($('#memName').val().length === 0) {
                    $('#l4').text(`尚未輸入`);
                } else
                    $('#l4').text(`輸入完畢`);
            })

        $('#memMobile').blur(
            () => {
                const r1 = /^09\d{8}$/;
                if (r1.test($('#memMobile').val())) {
                    $('#l5').text(`格式正確`)
                } else if ($('#memMobile').val().length === 0) {
                    $('#l5').text(`尚未輸入`);
                } else
                    $('#l5').text(`請輸入行動電話為09開頭，共10位數字號碼`);
            })
        $('#memAdd').blur(
            () => {
                if ($('#memAdd').val().length === 0) {
                    $('#l6').text(`尚未輸入`);
                } else
                    $('#l6').text(`輸入完畢`);
            })
        $('#memEmail').blur(
            () => {
                $.ajax({
                    type: 'POST',
                    url: '/CGA101G1/mem/MemEmailAuthServlet',
                    data: JSON.stringify({
                        memEmail: memEmail.value
                    }),
                    success: data => {
                        let { successful, message } = data;
                        console.log(successful)
                        console.log(message)
                        const r1 = /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
                        if (r1.test($('#memEmail').val()) && successful) {
                            $('#l7').text(`格式正確`)
                        } else if ($('#memEmail').val().length === 0) {
                            $('#l7').text(`尚未輸入`);
                        } else if (!successful) {
                            $('#l7').text(message);
                        } else
                            $('#l7').text(`請輸入電子郵件格式`);


                    }
                })
            })
        $("#btn1").click(
            () => {
                if ($('#memAccount').val().length === 0 ||
                    $('#memPassword').val().length === 0 ||
                    $('#confirmPassword').val().length === 0 ||
                    $('#memName').val().length === 0 ||
                    $('#memMobile').val().length === 0 ||
                    $('#memAdd').val().length === 0 ||
                    $('#memEmail').val().length === 0 ||
                    $('#memBirth').val().length === 0 ||
                    $('#memCity').val().length === 0 ||
                    $('#memDist').val().length === 0 ||
                    $('#memBirth').val().length === 0
                ) {
                    $('#l8').text(`輸入有誤或尚有欄位未輸入`);
                } else if (
                    $('#l1').text() === '請輸入英文及數字，且帳號長度需大於5小於13字數' ||
                    $('#l1').text() === '尚未輸入' ||
                    $('#l1').text() === '此帳號已有人使用' ||
                    $('#l2').text() === '請輸入英文及數字，且密碼長度需大於5小於13字數' ||
                    $('#l2').text() === '尚未輸入' ||
                    $('#l3').text() === '密碼不一致' ||
                    $('#l3').text() === '尚未輸入' ||
                    $('#l4').text() === '尚未輸入' ||
                    $('#l5').text() === '請輸入行動電話為09開頭，共10位數字號碼' ||
                    $('#l5').text() === '尚未輸入' ||
                    $('#l6').text() === '尚未輸入' ||
                    $('#l7').text() === '請輸入電子郵件格式' ||
                    $('#l7').text() === '此信箱已註冊過' ||
                    $('#l7').text() === '尚未輸入'
                ) {
                    $('#l8').text(`格式有誤或尚有欄位未輸入`);
                } else {
                    $('#l8').text('');

                    $.ajax({
                        type: 'POST',
                        url: "/CGA101G1/mem/RegisterServlet",
                        contentType: "application/json",
                        data: JSON.stringify({
                            memAccount: memAccount.value,
                            memPassword: memPassword.value,
                            confirmPassword: confirmPassword.value,
                            memName: memName.value,
                            memMobile: memMobile.value,
                            memAdd: memAdd.value,
                            memEmail: memEmail.value,
                            memBirth: memBirth.value,
                            memCity: memCity.value,
                            memDist: memDist.value,
                        }),
                        success: data => {
                            const { successful, message } = data;
                            if (successful) {
                                alert(message);
                                // location = "login.html";
                            } else {
                                $("#l8").html(message);
                            }
                        }
                    })
                }

            })



    </script>
</body>

</html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POP.Game</title>

    <link rel="stylesheet" href="https://unpkg.com/swiper@8/swiper-bundle.min.css" />
    <!-- font awesome cdn link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- custom css file link -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/css/allStyle.css">
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/css/style.css">
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/css/headerStyle.css">
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/css/footerStyle.css">


    <!-- Favicon -->
    <link rel="shortcut icon" href="/CGA101G1/frontend/mainCss/images/logo.png">
    <!-- Fonts CSS -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/assets/vendor/fonts/fonts.css">
    <!-- Bootstrap-icons CSS -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/assets/vendor/bootstrap/icons/bootstrap-icons.css">
    <!--Magnific-Popup CSS -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/assets/vendor/magnific/magnific-popup.css">
    <!-- Slick CSS -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/assets/vendor/slick/slick.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="/CGA101G1/frontend/mainCss/assets/css/style01.css">
</head>

<body>

    <!-- header section starts-->

    <header>

        <div class="logo-div">
            <img src="/CGA101G1/frontend/mainCss/images/logo.png" alt="">
            <a href="/CGA101G1/frontend/HomePage/HomePage.html" class="logo">帕Game</a>
        </div>


        <nav class="navbar">
            <!-- 上方標籤列 -->
            <a class="active" href="/CGA101G1/frontend/HomePage/HomePage.html">首頁</a>
            <a href="/CGA101G1/frontend/Product/HomePageinshop.html" class="nav-link">商品區</a>
            <a href="/CGA101G1/frontend/bid/listallbid.html" class="nav-link">競標區</a>
            <a href="/CGA101G1/frontend/forum/forumHomePage.jsp" class="nav-link">討論區</a>
        </nav>

        <div class="icons">
            <!--右上方小icon區-->
            <i class="fas fa-bars" id="menu-bars"></i>
            <a href="/CGA101G1/frontend/mem/updateMemberData.html" class="fas fa-solid fa-user-astronaut" id="login-icon"></a>
            <a href="/CGA101G1/frontend/Product/HomePageinProduct-wishlist.jsp" class="fas fa-heart"></a>
            <a href="/CGA101G1/frontend/Product/shopping-cart.html" class="fas fa-shopping-cart" id="cart"></a>
        </div>

    </header>


    <!-- header section ends-->

    <!-- home section starts-->

    <!-- Main -->
    <main>
        <!-- Breadcrumb -->
        <div class="py-3 bg-gray-100">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 my-2">
                        <h1 class="m-0 h4 text-center text-lg-start">Shop</h1>
                    </div>
                    <div class="col-lg-6 my-2">
                        <ol class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
                            <li class="breadcrumb-item"><a class="text-nowrap" href="index.html"><i
                                        class="bi bi-home"></i>Home</a></li>
                            <li class="breadcrumb-item text-nowrap active" aria-current="page">Product</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Breadcrumb -->
        <!--shop -->
        <section class="py-6">
            <div class="container">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-lg-4 col-xl-3 pe-xl-5 pt-9 pt-lg-0 shop-mob-toggle collapse d-lg-block"
                        id="shop_filter">
                        <!-- Mobile Toggle -->
                        <button class="p-3 btn-close position-absolute top-0 start-0 ms-2 mt-2 d-lg-none" type="button"
                            data-bs-toggle="collapse" data-bs-target="#shop_filter" aria-controls="shop_filter"
                            aria-expanded="false" aria-label="Toggle navigation">
                        </button>
                        <!-- End Mobile Toggle -->
                        <!-- Categories -->
                        <div class="shop-sidebar-block">
                            <div class="shop-sidebar-title" style="margin-bottom: 30px;">
                                <input type="text" class="form-control"
                                placeholder="Search Product"id="searchbar2"
                                name="searchKeyword">
                            <button class="btn btn-outline-warning" type="button"
                                id="button-addon2" style="width: 100%;">
                                <span class="material-icons-outlined">搜尋</span>
                            </button>
                            </div>
                            
                            <div class="shop-sidebar-title">
                                <a class="h5" data-bs-toggle="collapse" href="#shop_categories" role="button"
                                    aria-expanded="true" aria-controls="shop_categories">遊戲平台 <i
                                        class="bi bi-chevron-up"></i></a>
                            </div>
                            <div class="shop-category-list collapse show" id="shop_categories">
                                <ul class="nav flex-column" id="gamePlatformTypeUl">
                                    <!-- <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link active">所有平台</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">PS5</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">SWITCH</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">XBOX</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">PC</a>
                                    </li> -->
                                </ul>
                            </div>
                        </div>
                        <!-- End Categories -->
                        <!-- gender -->
                        <div class="shop-sidebar-block">
                            <div class="shop-sidebar-title">
                                <a class="h5" data-bs-toggle="collapse" href="#shop_Gender" role="button"
                                    aria-expanded="true" aria-controls="shop_Gender">遊戲種類 <i
                                        class="bi bi-chevron-up"></i></a>
                            </div>
                            <div class="shop-category-list collapse show" id="shop_Gender">
                                <ul class="nav flex-column" id="gameTypeUl">
                                    <!-- <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">動作</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">動作冒險</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">冒險</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">大型多人在線</a>
                                    </li> -->
                                </ul>
                            </div>
                        </div>
                        <!-- End Gender -->
                        <!-- Brands -->
                        <div class="shop-sidebar-block">
                            <div class="shop-sidebar-title">
                                <a class="h5" data-bs-toggle="collapse" href="#shop_brand" role="button"
                                    aria-expanded="true" aria-controls="shop_brand">遊戲公司 <i
                                        class="bi bi-chevron-up"></i></a>
                            </div>
                            <div class="shop-category-list collapse show" id="shop_brand">
                                <ul class="nav flex-column" id="gameCompanyUl">
                                    <!-- <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">Nintendo</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">Imagineer</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">2K</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">SEGA</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="javascript:void(0);" class="nav-link ">Sony Enterrainment</a>
                                    </li> -->
                                </ul>
                            </div>
                        </div>
                        <!-- End Brands -->
                    </div>
                    <!-- End Sidebar -->
                    <!-- Product Box -->
                    <div class="col-lg-8 col-xl-9">
                        <div class="shop-top-bar d-flex pb-3">
                        </div>
                        <div class="row g-3" id="content">
                            <!-- Product Box -->
                            <!-- <div class="col-sm-6 col-lg-4">
                                <div class="product-card-1">
                                    <div class="product-card-image">
                                        <div class="badge-ribbon">
                                            <span class="badge bg-danger">競標剩餘時間</span>
                                        </div>
                                        <div class="product-action">
                                            <a href="wishlist.html" class="btn btn-outline-primary">
                                                <i class="bi bi-heart"></i>
                                            </a>
                                            <a href="shop-compare.html" class="btn btn-outline-primary">
                                                <i class="bi bi-arrow-left-right"></i>
                                            </a>
                                            <a data-bs-toggle="modal" data-bs-target="#px-quick-view"
                                                href="javascript:void(0)" class="btn btn-outline-primary">
                                                <i class="bi bi-eye-fill"></i>
                                            </a>
                                        </div>
                                        <div class="product-media">
                                            <a href="product-details.html">
                                                <img class="img-fluid" src="/CGA101G1/frontend/mainCss/images/Mario.png" title="" alt="">
                                            </a>
                                        </div>
                                    </div>
                                    <div class="product-card-info">
                                        <div class="product-meta small">
                                            <a href="shop-fw-without-filtres.html">SWITCH</a>, <a
                                                href="shop-fw-without-filtres.html">Nintendo</a>
                                        </div>
                                        <h6 class="product-title">
                                            <a href="shop-fw-without-filtres.html">瑪利歐賽車 8 豪華版 Deluxe</a>
                                        </h6>
                                        <div class="product-price">
                                            <span class="text-primary">$500</span>
                                        </div>
                                    </div>
                                </div>
                            </div> -->
                            <!-- End Product Box -->
                            
                        </div>
                        <div class="shop-bottom-bar d-flex align-items-center mt-3">
                            <div class="ms-auto">
                                <ul class="pagination" id="pageid">

                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- 備份 -->
                    <!-- <div class="shop-bottom-bar d-flex align-items-center mt-3">
                        <div class="ms-auto">
                            <ul class="pagination" id="pageid">
                                <li class="page-item">
                                    <a class="page-link" href="javascript:void(0);" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="javascript:void(0);">1</a>
                                </li>
                                <li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
                                <li class="page-item"><a class="page-link" href="javascript:void(0);">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="javascript:void(0);" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div> -->
                    <!-- End Product Box -->
                </div>
            </div>
        </section>
        <!-- End Shop -->
    </main>
    </main>
    <!-- End Main -->

    <!-- Footer -->
    <footer class="bg-white footer">
        <div class="footer-top py-6">
            <div class="container">
                <div class="row">
                    <section class="footer">
                        <div class="box-container">
                            <div class="box">
                                <h3>會員專區</h3>
                                <a href="#">會員登入</a>
                                <a href="#">會員註冊</a>
                                <a href="#">訂單管理</a>
                                <a href="#">二手遊戲申請上架單管理</a>
                            </div>
                
                            <div class="box">
                                <h3>快速連結</h3>
                                <a href="#">首頁</a>
                                <a href="#">遊戲商城</a>
                                <a href="#">二手競標商城</a>
                                <a href="#">遊戲討論區</a>
                            </div>
                
                            <div class="box">
                                <h3>聯絡我們</h3>
                                <a href="#">02-3456-7890</a>
                                <a href="#">03-1111-2222</a>
                                <a href="#">CGA101G1@gmail.com</a>
                                <a href="#">anasbhai@gmail.com</a>
                            </div>
                
                            <div class="box">
                                <h3>關於我們</h3>
                                <a href="#">管理團隊</a>
                                <a href="#">創始理念</a>
                                <a href="#">insuagram</a>
                                <a href="#">linkedin</a>
                            </div>
                        </div>
                
                        <div class="credit">copyright@2022 by <span>CGA101G1</span></div>
                
                    </section>
                </div>
            </div>
        </div>

    </footer>
    <!-- End Footer -->
    
    <script src ="http://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>


<script type="module">

    // API 說明：https://api.kcg.gov.tw/ServiceList/Detail/9c8e1450-e833-499c-8320-29b36b7ace5c
    // API 路徑：https://api.kcg.gov.tw/api/service/Get/9c8e1450-e833-499c-8320-29b36b7ace5c
    // 備用 API：https://raw.githubusercontent.com/hexschool/KCGTravel/master/datastore_search.json
    let jsonUrl = "/CGA101G1/bid/bidProduct";
    function init(){
    const content = document.getElementById('content');
    const pageid = document.getElementById('pageid');
    let jsonData = {};

    fetch(jsonUrl, { method: 'get' })
      .then((response) => {
        return response.json();
      }).then((json) => {
        jsonData = json;
        // console.log(jsonData)
        pagination(jsonData, 1);
      })

    function pagination(jsonData, nowPage) {
    //   console.log("這是nowpage" + nowPage);
      // 取得全部資料長度
      const dataTotal = jsonData.length;

      // 設定要顯示在畫面上的資料數量
      // 預設每一頁只顯示 6 筆資料。
      const perpage = 9;

      // page 按鈕總數量公式 總資料數量 / 每一頁要顯示的資料
      // 這邊要注意，因為有可能會出現餘數，所以要無條件進位。
      const pageTotal = Math.ceil(dataTotal / perpage);

      // 當前頁數，對應現在當前頁數
      let currentPage = nowPage;

      // 因為要避免當前頁數筆總頁數還要多，假設今天總頁數是 3 筆，就不可能是 4 或 5
      // 所以要在寫入一個判斷避免這種狀況。
      // 當"當前頁數"比"總頁數"大的時候，"當前頁數"就等於"總頁數"
      // 注意這一行在最前面並不是透過 nowPage 傳入賦予與 currentPage，所以才會寫這一個判斷式，但主要是預防一些無法預期的狀況，例如：nowPage 突然發神經？！
      if (currentPage > pageTotal) {
        currentPage = pageTotal;
      }

      // 由前面可知 最小數字為 6 ，所以用答案來回推公式。
      const minData = (currentPage * perpage) - perpage + 1;
      const maxData = (currentPage * perpage);

      // 先建立新陣列
      const data = [];
      // 這邊將會使用 ES6 forEach 做資料處理
      // 首先必須使用索引來判斷資料位子，所以要使用 index
      jsonData.forEach((item, index) => {
        // 獲取陣列索引，但因為索引是從 0 開始所以要 +1。
        const num = index + 1;
        // 這邊判斷式會稍微複雜一點
        // 當 num 比 minData 大且又小於 maxData 就push進去新陣列。
        if (num >= minData && num <= maxData) {
          data.push(item);
        }
      })
      // 用物件方式來傳遞資料
      const page = {
        pageTotal,
        currentPage,
        hasPage: currentPage > 1,
        hasNext: currentPage < pageTotal,
      }
      displayData(data);
      pageBtn(page);
    }

    function displayData(data) {
      let str = '';
      let i = 1;
      data.forEach((bid) => {
        moment.locale('zh-tw');
        // 取得現在時間
        let now = moment().valueOf();
        // 取得競標商品時間
        let bidLaunchedTime = moment(Date.parse(bid.bidLaunchedTime)).format('YYYY-MM-DD HH:mm:SS');
        let bidSoldTime = Date.parse(bid.bidSoldTime) < now ? ( bid.bidState === 1 ? "截標" : (bid.bidState === 2)? "流標" : "棄標" ): moment(Date.parse(bid.bidSoldTime)).format('YYYY-MM-DD HH:mm:SS');
        str += `<div class="col-sm-6 col-lg-4">
                <div class="product-card-1">
                    <div class="product-card-image">
                        <div class="badge-ribbon">
                            <span class="badge bg-danger">競標開始時間 :${bidLaunchedTime}</span>
                            <span class="badge bg-danger">競標截止時間 :${bidSoldTime}</span>
                        </div>

                        <div class="product-media">
                            <a href="/CGA101G1/frontend/bid/listonebid.html?bidProductNo=${bid.bidProductNo}">
                                <img class="img-fluid" src="/CGA101G1/bid/bidPicGetOne?bidProductNo=${bid.bidProductNo}" title="" alt="">
                            </a>
                        </div>
                    </div>
                        <div class="product-card-info">
                                <h6 class="product-title">
                                    <a href="/CGA101G1/frontend/bid/listonebid.html?bidProductNo=${bid.bidProductNo}">${bid.bidName}</a>
                                </h6>
                                <div class="product-price">
                                        <span class="text-primary" id="bidHighestPrice${bid.bidProductNo}">目前無出價紀錄</span>
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
                content.innerHTML = str;

// 最高出價刷新
                $.ajax({
                    url: "/CGA101G1/bid/bidRecordGetAllJson",
                    type: "POST",
                    success: function(data){
                        changeBidPrice(data);
                    }
                })

                function changeBidPrice(data){
                    let allBidRecords = JSON.parse(data);
                        for( let bidRecordVO of allBidRecords){
                            let bidProduct = document.querySelector(`#bidHighestPrice${bidRecordVO.bidProductNo}`);
                            if(bidProduct){
                                bidProduct.innerHTML=`目前出價 $ ${bidRecordVO.bidPrice}`;
                            }
                    }
                }

    }

    function pageBtn(page) {
      let str = '';
      const total = page.pageTotal;

      if (page.hasPage) {
        str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) - 1}">Previous</a></li>`;
      } else {
        str += `<li class="page-item disabled"><span class="page-link">Previous</span></li>`;
      }


      for (let i = 1; i <= total; i++) {
        if (Number(page.currentPage) === i) {
          str += `<li class="page-item active"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
        } else {
          str += `<li class="page-item"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
        }
      };

      if (page.hasNext) {
        str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) + 1}">Next</a></li>`;
      } else {
        str += `<li class="page-item disabled"><span class="page-link">Next</span></li>`;
      }

      pageid.innerHTML = str;
    }

    function switchPage(e) {
      e.preventDefault();
      if (e.target.nodeName !== 'A') return;
      const page = e.target.dataset.page;
      pagination(jsonData, page);
    }

    pageid.addEventListener('click', switchPage);
};

init();


// 搜尋功能新增
document.getElementById("button-addon2").addEventListener('click', search);
	function search() {
		let keyword = document.getElementById("searchbar2").value;
		jsonUrl = `/CGA101G1/bid/bidProductSearch?keyword=${keyword}`;
        init();
		}

// 遊戲分類專區
$.ajax({
    url: "/CGA101G1/bid/bidProductGetGame",
    type: "POST",
    success: function(data){
        showAllGame(data);
    }
})
function showAllGame(data){
    // 取得資料 分類
    let gameAll = JSON.parse(data);
    let gamePlatformTypeVOs = gameAll.gamePlatformTypeVOs;
    let gameTypeVOs = gameAll.gameTypeVOs;
    let gameCompanyVOs = gameAll.gameCompanyVOs;

    // 動態塞入網頁
    let gamePlatformTypeUl = document.querySelector("#gamePlatformTypeUl");
    let gameTypeUl = document.querySelector("#gameTypeUl");
    let gameCompanyUl = document.querySelector("#gameCompanyUl");

    // 塞入gamePlatformType
    let str1 = '';
    gamePlatformTypeVOs.forEach((gamePlatformTypeVO)=>{
        str1+=`<li class="nav-item gameSidebar">
            <a href="javascript:void(0);" class="nav-link active" id="${gamePlatformTypeVO.gamePlatformNo}">${gamePlatformTypeVO.gamePlatformName}</a>
            </li>`
        })
        gamePlatformTypeUl.innerHTML=str1;

    // 塞入gameType
    let str2 = '';
    gameTypeVOs.forEach((gameTypeVO)=>{
        str2+=`<li class="nav-item gameSidebar">
            <a href="javascript:void(0);" class="nav-link active" id="${gameTypeVO.gameTypeNo}">${gameTypeVO.gameTypeName}</a>
            </li>`
    })
    gameTypeUl.innerHTML=str2;

    // 塞入gameCompany
    let str3 = '';
    gameCompanyVOs.forEach((gameCompanyVO)=>{
        str3+=`<li class="nav-item gameSidebar">
            <a href="javascript:void(0);" class="nav-link active" id="${gameCompanyVO.gameCompanyNo}">${gameCompanyVO.gameCompanyName}</a>
            </li>`
    })
    gameCompanyUl.innerHTML=str3;

    // 註冊監聽器 發出ajax請求
    $(".gameSidebar").on('click', function(e){
        let searchId = e.target.id;
        jsonUrl = `/CGA101G1/bid/bidProductGameSearch?keyword=${searchId}`;
        init();
    });
}




  </script>

    <script src="https://unpkg.com/swiper@8/swiper-bundle.min.js"></script>
    <!-- 外來區 -->
    <!-- jquery -->
    <script src="/CGA101G1/frontend/mainCss/assets/js/jquery-3.5.1.min.js"></script>
    <!-- appear -->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/appear/jquery.appear.js"></script>
    <!--bootstrap-->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- owl-carousel -->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/slick/slick.min.js"></script>
    <!-- magnific -->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/magnific/jquery.magnific-popup.min.js"></script>
    <!-- isotope -->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/isotope/isotope.pkgd.min.js"></script>
    <!-- count-down -->
    <script src="/CGA101G1/frontend/mainCss/assets/vendor/count-down/jquery.countdown.min.js"></script>
    <!-- Theme Js -->
    <script src="/CGA101G1/frontend/mainCss/assets/js/custom.js"></script>
    <!-- 外來區over -->
    <!-- custom js file link-->
    <script src="/CGA101G1/frontend/mainCss/js/script.js"></script>
</body>

</html>